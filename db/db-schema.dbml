table harvesting.oai_sets {
  id varchar [pk]
  name varchar [not null, unique]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  is_active boolean [not null, default: true]
}

table harvesting.oai_records {
  id varchar [pk]
  url varchar [not null, unique]
  title varchar [not null]
  creator varchar [not null]
  subject varchar [not null]
  description text [not null]
  publisher varchar [not null]
  contributor varchar [not null]
  inferred_issue_date date [not null]
  oai_set_id varchar [not null, ref: > harvesting.oai_sets.id]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  is_active boolean [not null, default: true]
}

table harvesting.study_variable_classes {
  id int [pk, increment]
  long_name varchar [not null, unique]
  short_name varchar [not null, unique]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table harvesting.study_variables {
  id int [pk, increment]
  long_name varchar [not null, unique]
  short_name varchar [not null, unique]
  is_numeric_continuous boolean [not null]
  is_numeric_discrete boolean [not null]
  is_categorical_nominal boolean [not null]
  is_categorical_ordinal boolean [not null]
  study_variable_class_id int [not null, ref: > harvesting.study_variable_classes.id]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table harvesting.thesis_assignments {
  id int [pk, increment]
  user_id int [not null, ref: > auth.users.id]
  oai_record_id varchar [not null, ref: > harvesting.oai_records.id]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  Indexes {
    (user_id, oai_record_id) [unique]
  }
}

table harvesting.survey_assignments {
  id int [pk, increment]
  thesis_assignment_id int [not null, ref: > harvesting.thesis_assignments.id]
  limesurvey_survey_id int [not null]
  limesurvey_survey_token varchar [not null]
  is_dispatched boolean [not null, default: false]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  Indexes {
    (thesis_assignment_id, limesurvey_survey_id) [unique]
  }
}

table harvesting.questions {
  id int [pk, increment]
  limesurvey_survey_id int [not null]
  // represents the field "code" that appears in the user interface
  // when creating new questions or subquestions.
  // In the limesurvey db tables is named "tile"
  limesurvey_question_title varchar(20) [not null, unique]
  limesurvey_question_id int [not null, unique]
  study_variable_id int [not null, ref: > harvesting.study_variables.id]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table harvesting.responses {
  id bigint [pk, increment]
  limesurvey_question_title varchar(20) [not null, ref: > harvesting.questions.limesurvey_question_title]
  limesurvey_answer_code varchar(5) [not null]
  limesurvey_survey_assignment_id int [not null, ref: > harvesting.survey_assignments.id]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table auth.users {
  id int [pk, increment]
  first_name varchar [not null]
  last_name varchar [not null]
  email varchar [not null, unique]
  password varchar [not null]
  is_root boolean [not null, default: false]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  is_active boolean [not null, default: true]
}

table auth.users_groups {
  id int [pk, increment]
  user_id int [not null, ref: > auth.users.id]
  group_id int [not null, ref: > auth.groups.id]
  
  Indexes {
    (user_id, group_id) [unique]
  }
}

table auth.groups {
  id int [pk, increment]
  name varchar [not null, unique]
  is_root boolean [not null, default: false]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  is_active boolean [not null, default: true]
}

table auth.groups_permissions {
  id int [pk, increment]
  group_id int [not null, ref: > auth.groups.id]
  permission_id int [not null, ref: > auth.permissions.id]
  
  Indexes {
    (group_id, permission_id) [unique]
  }
}


table auth.permissions {
  id int [pk, increment]
  name varchar [not null, unique]
  webapp_related_path varchar [not null, unique]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  is_active boolean [not null, default: true]
}

table core.sysparams {
  key varchar [pk]
  value varchar [not null]
}